<#
 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—     
 â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘â•šâ•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â•šâ•â•â–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘     
 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘  â–ˆâ–ˆâ–ˆâ•”â• â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     
 â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•”â•â•â•â• â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ–ˆâ•”â•  â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     
 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
 â•šâ•â•â•â•â•â•â•â•šâ•â•  â•šâ•â•â•â•   â•šâ•â•   â•šâ•â•     â•šâ•â•  â•šâ•â•â•šâ•â•â•â•â•â•â•â•šâ•â•  â•šâ•â•â•šâ•â•â•â•â•â•â•
 IntraSeal Security Layer v1.1 - Internal QA Isolation Tool
 (c) 2025 NicolÃ¡s Pintos www.nicolaspintos.com - Restricted corporate utility
#>

Write-Host "â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—" -ForegroundColor Cyan
Write-Host "â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘â•šâ•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘" -ForegroundColor Cyan
Write-Host "â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘" -ForegroundColor Cyan
Write-Host "â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â•šâ•â•â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘" -ForegroundColor Cyan
Write-Host "â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—" -ForegroundColor Cyan
Write-Host "â•šâ•â•â•šâ•â•  â•šâ•â•â•â•   â•šâ•â•   â•šâ•â•â•â•â•â•â•â•šâ•â•  â•šâ•â•â•šâ•â•â•â•â•â•â•â•šâ•â•â•â•â•â•â•â•šâ•â•  â•šâ•â•â•šâ•â•â•â•â•â•â•" -ForegroundColor Cyan
Write-Host ""
Write-Host "     IntraSeal v1.1 - INTERNAL SECURITY FRAMEWORK" -ForegroundColor DarkCyan
Write-Host "     (c) 2025 NicolÃ¡s Pintos Â· www.nicolaspintos.com" -ForegroundColor DarkCyan
Write-Host ""

param (
    [string]$TargetFolder = (Get-Location).Path
)

Write-Host "`nğŸ›¡ï¸ IntraSeal - ProtecciÃ³n interna activada en: $TargetFolder" -ForegroundColor Cyan

function Bloquear-ExeEnFirewall {
    param([string]$exePath)
    $ruleName = "IntraSeal_" + (Split-Path $exePath -Leaf)
    if (-not (Get-NetFirewallApplicationFilter | Where-Object { $_.Program -eq $exePath })) {
        New-NetFirewallRule -DisplayName $ruleName `
            -Direction Outbound `
            -Program $exePath `
            -Action Block `
            -Profile Any `
            -Enabled True `
            -ErrorAction SilentlyContinue
    }
}

function Agregar-ExclusionDefender {
    param([string]$folderPath)
    Add-MpPreference -ExclusionPath $folderPath -ErrorAction SilentlyContinue
}

function Detectar-Antivirus {
    return Get-CimInstance -Namespace "root\SecurityCenter2" -ClassName AntiVirusProduct | Select-Object displayName
}

$executables = Get-ChildItem -Path $TargetFolder -Recurse -Include *.exe -File -ErrorAction SilentlyContinue
Write-Host "`nğŸ” Ejecutables encontrados: $($executables.Count)`n" -ForegroundColor Yellow

foreach ($exe in $executables) {
    Write-Host "ğŸš« Bloqueando salida: $($exe.FullName)" -ForegroundColor DarkGreen
    Bloquear-ExeEnFirewall -exePath $exe.FullName
}

$av = Detectar-Antivirus
$defender = $av | Where-Object { $_.displayName -like "*Defender*" }

if ($defender) {
    Write-Host "`nâœ… Windows Defender detectado. Protegiendo carpeta..." -ForegroundColor Green
    Agregar-ExclusionDefender -folderPath $TargetFolder
    Write-Host "ğŸ›¡ï¸ Carpeta excluida correctamente de Defender."
} else {
    Write-Host "`nâš ï¸ Windows Defender no estÃ¡ activo." -ForegroundColor Red
    foreach ($a in $av) {
        Write-Host "ğŸ” Antivirus detectado: $($a.displayName)"
    }
    Write-Host "`nğŸ“Œ Sugerencia: Agregue manualmente esta carpeta como exclusiÃ³n de su antivirus: `n$TargetFolder" -ForegroundColor DarkYellow
}

try {
    $Desktop = [Environment]::GetFolderPath("Desktop")
    $LogPath = Join-Path $Desktop "IntraSeal_log.txt"
    $timestamp = (Get-Date -Format 'yyyy-MM-dd HH:mm:ss')
    $logLines = @()
    $logLines += "$timestamp ğŸ”’ IntraSeal activado en: $TargetFolder"
    $logLines += "$timestamp ğŸ§© Ejecutables encontrados: $($executables.Count)"
    foreach ($exe in $executables) {
        $logLines += "$timestamp ğŸš« Bloqueado: $($exe.FullName)"
    }
    if ($defender) {
        $logLines += "$timestamp âœ… Defender activo. Carpeta excluida: $TargetFolder"
    } else {
        $logLines += "$timestamp âš ï¸ Defender no detectado."
        foreach ($a in $av) {
            $logLines += "$timestamp ğŸ” Otro AV detectado: $($a.displayName)"
        }
    }
    $logLines += "$timestamp âœ”ï¸ Proceso completado correctamente."
    [System.IO.File]::WriteAllLines($LogPath, $logLines, [System.Text.Encoding]::UTF8)
    Write-Host "`nğŸ“ Log guardado en: $LogPath" -ForegroundColor Gray
} catch {
    Write-Host "`nâš ï¸ No se pudo guardar el log en el escritorio." -ForegroundColor DarkRed
}

Add-Type -AssemblyName PresentationFramework
$popup = [System.Windows.MessageBox]::Show("Â¿DeseÃ¡s visitar la web del autor?
www.nicolaspintos.com", "IntraSeal", "YesNo", "Question")
if ($popup -eq "Yes") {
    Start-Process "https://www.nicolaspintos.com"
}
